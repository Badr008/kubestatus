<html>
  <head>
    <title>Kubestatus</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div>
      <div class="container mt-5">
        <h2>This is a Server Status Page</h2>
        <p>
          using
          <a href="https://github.com/soub4i/kubestatus" target="_blank">
            KubeStatus project
          </a>
        </p>

        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                Server Status
              </div>
              <div class="card-body" id="services"></div>
              <div class="card-footer text-muted">
                refresh automatically every 1min
              </div>
            </div>
          </div>
        </div>

        <br />

        <div class="row text-center border-top">
          <div class="col-md-12 mt-2">
            <p>&copy; KubeStatus</p>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    function updateUI(service, el) {
      const p = document.createElement('p')
      const status = `<span class="badge bg-${
        service.Status ? 'success' : 'danger'
      }">${service.Status ? 'UP' : 'DOWN'}</span>`
      p.innerHTML = `Service: ${service.Name} |  Status: ${status}`
      el.appendChild(p)
    }

    const fetchData = async () => {
      const data = await (await fetch('/status')).json()
      const services = document.querySelector('#services')
      services.innerHTML = ''

      for (const service of data) {
        updateUI(service, services)
      }
    }
    fetchData()
    const timer = setInterval(fetchData, 60 * 1000)
  </script>
</html>
